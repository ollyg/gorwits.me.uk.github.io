<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>Cats and Code &#187; linux</title>
	<atom:link href="http://blog.gorwits.me.uk/category/linux/feed/" rel="self" type="application/rss+xml" />
	<link>http://blog.gorwits.me.uk</link>
	<description>by Oliver Gorwits</description>
	<lastBuildDate>Sat, 29 Mar 2014 23:28:44 +0000</lastBuildDate>
	<language>en-US</language>
	<sy:updatePeriod>hourly</sy:updatePeriod>
	<sy:updateFrequency>1</sy:updateFrequency>
	<generator>http://wordpress.org/?v=3.6.1</generator>
		<item>
		<title>Internet accessible cats &#8211; part 2</title>
		<link>http://blog.gorwits.me.uk/2013/01/03/internet-accessible-cats-part-2/?utm_source=rss&#038;utm_medium=rss&#038;utm_campaign=internet-accessible-cats-part-2</link>
		<comments>http://blog.gorwits.me.uk/2013/01/03/internet-accessible-cats-part-2/#comments</comments>
		<pubDate>Thu, 03 Jan 2013 22:08:21 +0000</pubDate>
		<dc:creator>Oliver Gorwits</dc:creator>
				<category><![CDATA[cats]]></category>
		<category><![CDATA[linux]]></category>
		<category><![CDATA[networking]]></category>
		<category><![CDATA[transcoding]]></category>
		<category><![CDATA[video]]></category>
		<category><![CDATA[virtualization]]></category>

		<guid isPermaLink="false">http://blog.gorwits.me.uk/?p=855</guid>
		<description><![CDATA[So far so good for access to the new Cat Cam: from within the house we can view video from the cats&#8217; shed, yet the camera is safely on its own DMZ. In this final post I&#8217;ll show how I &#8230; <a class="more-link" href="http://blog.gorwits.me.uk/2013/01/03/internet-accessible-cats-part-2/">Continue reading <span class="meta-nav">&#8594;</span></a>]]></description>
				<content:encoded><![CDATA[<p>So far so good for access to the new Cat Cam: from within the house we can view video from the cats&#8217; shed, yet the camera is safely on its own DMZ.</p>
<p>In this final post I&#8217;ll show how I made the camera video feed available on the Internet.</p>
<p>One thing I wanted from the outset was for Internet clients not to make direct connections to the camera itself. I was a little worried about the ability of the web server and CPU in the camera to cope with multiple clients, and also the security implications of direct access. AÂ second requirement was to have multi platform access &#8211; that is, desktop and iOS. This potentially means different streaming video formats.</p>
<p>We have one linux server in the house, which is used for many different things and runs <a href="http://blog.gorwits.me.uk/2012/01/04/virtual-machine-on-mythbuntu/" target="_blank">virtual machines</a>. My back-of-an-envelope plan looked something like this:</p>
<p><a href="http://blog.gorwits.me.uk/2013/01/03/internet-accessible-cats-part-2/cat-internet-3/" rel="attachment wp-att-858"><img class="aligncenter size-full wp-image-858" title="cat-internet" src="http://blog.gorwits.me.uk/wp-content/blog.gorwits.me.uk/2012/12/cat-internet2.png" alt="" width="250" height="382" /></a></p>
<p>First step was to create the VM, but remember that the camera feed is in a DMZ using a VLAN, so the VM must live there too. In KVM it&#8217;s possible either to send all traffic to a guest system and let it process the VLANs or, you can separate the tagged VLAN traffic in the host system so the guest is dumb and just sees untagged frames. Clearly the latter is preferable so that were the guest to suffer attack from the Internet, it ought not to be able to put traffic onto the house workstation network. The guest is completely within the DMZ.</p>
<p>With that done and a basic Ubuntu system installed, I started work on Apache and <a href="http://www.videolan.org/vlc/index.html" target="_blank">VLC</a> (the Swiss Army Chainsaw of video processing). First up, VLC&#8230;</p>
<p>Luckily the camera&#8217;s video feed comes in MJPEG format with a discoverable URL. The idea is to take this feed, duplicate it, and transcode the respective feeds into something suitable for a desktop browser and for iOS. As a bonus, I&#8217;ll timestamp the video to make it easy to tell if the transcoder has crashed (the timestamp would be wrong). After a <em>lot</em>Â of reading online about how to configure VLC I came up with the following monstrosity:</p>
<pre class="brush: plain; title: ; notranslate">
/usr/bin/cvlc -I dummy http://guest:guest@172.16.30.10:8888/videostream.cgi?rate=0
  --sout='#duplicate{

    dst=&quot;transcode{
      width=320,heigh=240,fps=25,vcodec=h264,vb=256,acodec=none,
      venc=x264{profile=baseline,level=30,keyint=30,ref=1},
      sfilter=marq{marquee=\&quot;[%Y-%m-%d %H:%M:%S]\&quot;,position=8,size=18}
    }:std{access=livehttp{
        seglen=10,delsegs=true,numsegs=5,
        index=/var/www/streaming/cats.m3u8,
        index-url=/streaming/cats-########.ts},
      mux=ts{use-key-frames},
      dst=/var/www/streaming/cats-########.ts}&quot;,

    dst=&quot;transcode{
      width=640,heigh=480,fps=25,vcodec=theo,vb=512,acodec=none,
      sfilter=marq{marquee=\&quot;[%Y-%m-%d %H:%M:%S]\&quot;,position=8,size=18}
    }:http{mux=ogg,dst=127.0.0.1:8081/catcam.ogg}&quot;

  }'
</pre>
<p>Of the two transcodesÂ (&#8220;dst=&#8221;), the second is more straightforward. It creates an <a href="http://en.wikipedia.org/wiki/Ogg" target="_blank">Ogg</a> format stream using the <a href="http://en.wikipedia.org/wiki/Theora" target="_blank">Theora</a> video codec, which modern browsers should be able to cope with. This is a video stream being served from VLC&#8217;s built-in web server, so I&#8217;ll need to proxy it via Apache. The configuration also applies a filter (&#8220;sfilter=&#8221;) to add a timestamp on the video stream.</p>
<p>The first transcode uses the new <a href="https://developer.apple.com/resources/http-streaming/" target="_blank">HTTP Live Streaming</a> support in VLC. This is a rather elegant specification from Apple (which is why I selected it for the iOS clients) for simple and efficient delivery of streaming video. It creates a set of files and assumes you have a web server to serve them. The files each contain a few seconds of video, and the client retrieves them and plays one after another. The &#8220;######&#8221; templates an incrementing number within the segment filename. Again, the timestamp is added to the video stream.</p>
<p>CPU load for the above runs at about 60% (in the VM) on the dual core Athlon X2 245e processor. I wrapped the above in an <a href="http://upstart.ubuntu.com/" target="_blank">Upstart</a> init file, and just in case VLC gets its knickers in a twist, I added a cron job to periodically stop and start the service.</p>
<p>Now on to Apache. It needs to proxy the Ogg stream and serve the Live Streaming files, and prevent any other access to the web server:</p>
<pre class="brush: plain; title: ; notranslate">
# redirect any non-cat requests to the cat index.html
RewriteEngine on
RewriteCond %{REQUEST_URI} !^/streaming/cats.*
RewriteCond %{REQUEST_URI} !^/stream/catcam.ogg$
RewriteCond %{REQUEST_URI} !^/index.html$
RewriteRule ^(.*) http://%{HTTP_HOST}/index.html [R,L]

ProxyReceiveBufferSize 16384
ProxyRequests On
ProxyVia On
ProxyPreserveHost On

&lt;Proxy *&gt;
    Order deny,allow
    Allow from all
&lt;/Proxy&gt;

# VLC server stream
ProxyPass /stream/catcam.ogg http://localhost:8081/catcam.ogg
ProxyPassReverse /stream/catcam.ogg http://localhost:8081/catcam.ogg
</pre>
<p>Last but not least for this server, we need a web page which offers up the two video streams. This uses an HTML5 video tag:</p>
<pre class="brush: xml; title: ; notranslate">
&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Cat Cam&lt;/title&gt;
        &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=ISO-8859-1&quot;&gt;
        &lt;META HTTP-EQUIV=&quot;Pragma&quot; CONTENT=&quot;no-cache&quot;&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;Cat Cam&lt;/h1&gt;
        &lt;video id=&quot;video&quot; autoplay=&quot;autoplay&quot;&gt;
            &lt;source src=&quot;/streaming/cats.m3u8&quot;&gt;
            &lt;source src=&quot;/stream/catcam.ogg&quot; type=&quot;video/ogg; codecs=theora&quot;&gt;
            Your browser doesn't appear to support the HTML5 &lt;code&gt;&amp;lt;video&amp;gt;&lt;/code&gt; element.
        &lt;/video&gt;
    &lt;/body&gt;
&lt;/html&gt;
</pre>
<p>All that remains is to enable a NAT rule and firewall pinhole on the home router for the web server (which is, of course, in the DMZ network connected directly to the router).</p>
<p>Let&#8217;s see the end result, taken on my iPhone this evening, also demonstrating the automatically activated night vision mode:</p>
<p><a href="http://blog.gorwits.me.uk/2013/01/03/internet-accessible-cats-part-2/cat-ngith/" rel="attachment wp-att-884"><img class="aligncenter size-full wp-image-884" title="cat-ngith" src="http://blog.gorwits.me.uk/wp-content/blog.gorwits.me.uk/2012/12/cat-ngith.png" alt="" width="400" height="267" /></a></p>
<p>It&#8217;s nice to be able to check in on the wee beasties when I&#8217;m out at work. Other than a lot of reading about VLC, it wasn&#8217;t particularly difficult to do, and I think the end result is really quite good.</p>
]]></content:encoded>
			<wfw:commentRss>http://blog.gorwits.me.uk/2013/01/03/internet-accessible-cats-part-2/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>Virtual Machine on Mythbuntu</title>
		<link>http://blog.gorwits.me.uk/2012/01/04/virtual-machine-on-mythbuntu/?utm_source=rss&#038;utm_medium=rss&#038;utm_campaign=virtual-machine-on-mythbuntu</link>
		<comments>http://blog.gorwits.me.uk/2012/01/04/virtual-machine-on-mythbuntu/#comments</comments>
		<pubDate>Wed, 04 Jan 2012 23:45:10 +0000</pubDate>
		<dc:creator>Oliver Gorwits</dc:creator>
				<category><![CDATA[devops]]></category>
		<category><![CDATA[htpc]]></category>
		<category><![CDATA[linux]]></category>
		<category><![CDATA[networking]]></category>
		<category><![CDATA[virtualization]]></category>

		<guid isPermaLink="false">http://blog.gorwits.me.uk/?p=728</guid>
		<description><![CDATA[I have a Linux box running the excellent Mythbuntu (Ubuntu-based) distribution, headless (that is, without a monitor). Quite a lot of the time it&#8217;s sat around doing nothing (and even during recording or playback the CPU is idle). For some &#8230; <a class="more-link" href="http://blog.gorwits.me.uk/2012/01/04/virtual-machine-on-mythbuntu/">Continue reading <span class="meta-nav">&#8594;</span></a>]]></description>
				<content:encoded><![CDATA[<p>I have a Linux box running the excellent <a href="http://www.mythbuntu.org/" target="_blank">Mythbuntu</a> (Ubuntu-based) distribution, headless (that is, without a monitor). Quite a lot of the time it&#8217;s sat around doing nothing (and even during recording or playback the CPU is idle).</p>
<p>For some side-projects I wanted a clean Linux installation to mess about with. It seemed a good idea to run virtual machines and make the most of existing hardware; what surprised me was just how easy this turned out to be <img src='http://blog.gorwits.me.uk/wp-includes/images/smilies/icon_smile.gif' alt=':-)' class='wp-smiley' /> </p>
<p>The <a href="https://help.ubuntu.com/community/KVM" target="_blank">Ubuntu documentation for KVM</a> is excellent, I must say, but I fancied distilling things further and blogging here, as I typically do to record most of my technical adventures. I&#8217;m not going to bother with any of the GUI VM builder tools or even the Q&amp;A install script, but simply specify the VM config fully, up front.</p>
<p>Optionally, check whether your CPU has virtualization extensions &#8211; any fairly recent desktop chip should do. On Ubuntu there&#8217;s a command called <code>kvm-ok</code>, or you can poke <code>/proc/cpuinfo</code>:</p>
<pre class="brush: plain; title: ; notranslate">
# kvm-ok
INFO: /dev/kvm exists
KVM acceleration can be used

# egrep -q '(vmx|svm)' /proc/cpuinfo &amp;&amp; echo 'good to go!'
good to go!
</pre>
<p>First up install the KVM software:</p>
<pre class="brush: plain; title: ; notranslate">
# apt-get install qemu-kvm virtinst
</pre>
<p>This will pull in all the necessary packages. On other platforms it should be similar, but the <code>virtinst</code> package is often renamed (e.g. <code>virt-install</code> or <code>vm-install</code>).</p>
<p>Before getting stuck in to KVM we need to reconfigure the system&#8217;s network adapter to be a bridge. I prefer to set a static IP for servers on my home LAN and use the <code>/etc/network/interfaces</code> file for configuration:</p>
<pre class="brush: plain; title: ; notranslate">
# cat &gt; /etc/network/interfaces
auto lo eth0 br0
iface lo inet loopback
iface eth0 inet manual
iface br0 inet static
    address &lt;IP-ADDRESS&gt;
    network &lt;NETWORK-ADDRESS&gt;
    netmask &lt;NETMASK&gt;
    broadcast &lt;BROADCAST&gt;
    gateway &lt;GATEWAY&gt;
    bridge_ports eth0
    bridge_stp off
    bridge_fd 0
    bridge_maxwait 0
    post-up ip link set br0 address &lt;MAC-ADDRESS&gt;

(hit ctrl-D)
</pre>
<p>Obviously, fill in the blanks for your own system&#8217;s IP and MAC address details. Next we can blow away Ubuntu&#8217;s network mangler daemon and poke the KVM service into life:</p>
<pre class="brush: plain; title: ; notranslate">
# apt-get --purge remove network-manager
# /etc/init.d/networking restart
# service libvirt-bin start
</pre>
<p>Now find somewhere on your disk for the VMs and a little script to live, and create a directory. I named mine <code>/opt/vm</code>. In there, try starting with this little shell script:</p>
<pre class="brush: plain; title: ; notranslate">
#!/bin/bash
virt-install --name=sandbox --ram=512 --vcpus=2 --os-type=linux \
  --autostart --disk=path=/opt/vm/sandbox.img,size=50 \
  --graphics=vnc,listen=0.0.0.0,port=5900 --noautoconsole \
  --cdrom=/opt/vm/mythbuntu-11.10-desktop-i386.iso
</pre>
<p>Walking through the above, it should be clear we&#8217;re creating a new VM called <code>sandbox</code> (this is the name KVM knows it by, not a hostname), with 512MB RAM, two virtual CPUs, a Linux-friendly boot environment, and 50GB (sparse) disk. The VM will be automatically booted by the KVM service when its host system boots. The last line specifies an installation CD image from which the new VM will boot.</p>
<p>For the graphics configuration I&#8217;ve asked for a headless system with the console being offered up via a VNC port on the host server. Note that the <code>listen=0.0.0.0</code> is <em>essential</em> to connect remotely (e.g. over your home LAN) to the console because otherwise the VNC port is simply bound to the loopback interface.</p>
<p>Running the above will bring the new VM into life:</p>
<pre class="brush: plain; title: ; notranslate">
# ./sandbox.sh

Starting install...
Creating storage file sandbox.img                      |  50 GB     00:00
Creating domain...                                     |    0 B     00:01
Domain installation still in progress. You can reconnect to
the console to complete the installation process.
</pre>
<p>What KVM means by &#8220;installation still in progress&#8221; is that it knows this system is installing from the boot CD, so you should go right ahead and fire up VNC and connect to the console (port 5900 on the host server) to complete the process.</p>
<p>You&#8217;ll find that KVM saved the <code>sandbox</code> VM configuration in XML format in the <code>/etc/libvirt/qemu</code> directory, so that&#8217;s where to go to tweak the settings. <a href="http://libvirt.org/formatdomain.html" target="_blank">Good documentation</a> is available at the KVM website.</p>
<p>Be aware, however, that because KVM assumed the attached CD ISO was only needed for initial install, it&#8217;s not featured in the saved config as a permanent connection. You can, of course, remedy this (check out the <code>virt-install</code> man page for starters).</p>
<p>To finish off, here&#8217;s how to manage the lifecycle (start, restart, blow away, etc) of the VM. Use the <code>virsh</code> utility which can either be run with a single instruction or with no parameters for an interactive CLI:</p>
<pre class="brush: plain; title: ; notranslate">
# virsh
Welcome to virsh, the virtualization interactive terminal.
virsh # list
 Id Name                 State
----------------------------------
 10 sandbox              running

virsh # destroy
error: command 'destroy' requires &lt;domain&gt; option
virsh # destroy sandbox
Domain sandbox destroyed

virsh # create sandbox
error: Failed to open file 'sandbox': No such file or directory

virsh # create sandbox.xml
Domain sandbox created from sandbox.xml

virsh # list
 Id Name                 State
----------------------------------
 11 sandbox              running
</pre>
<p>Try the <code>help</code> command, and note that the VM&#8217;s XML settings file may need updating if you change things  (see <code>dumpxml</code>).</p>
<p>I hope this is a useful and quick tutorial for KVM on Ubuntu&#8230; Good Luck!</p>
]]></content:encoded>
			<wfw:commentRss>http://blog.gorwits.me.uk/2012/01/04/virtual-machine-on-mythbuntu/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>Hacking # in OS X</title>
		<link>http://blog.gorwits.me.uk/2011/11/30/hacking-in-os-x/?utm_source=rss&#038;utm_medium=rss&#038;utm_campaign=hacking-in-os-x</link>
		<comments>http://blog.gorwits.me.uk/2011/11/30/hacking-in-os-x/#comments</comments>
		<pubDate>Wed, 30 Nov 2011 20:57:05 +0000</pubDate>
		<dc:creator>Oliver Gorwits</dc:creator>
				<category><![CDATA[linux]]></category>
		<category><![CDATA[OS X]]></category>
		<category><![CDATA[perl]]></category>
		<category><![CDATA[productivity]]></category>

		<guid isPermaLink="false">http://blog.gorwits.me.uk/?p=717</guid>
		<description><![CDATA[To get aÂ # sign on an Apple keyboard you use the Option (or Alt) key + 3. This seems terribly klunky to me, andÂ # is of course used quite a bit in programming and sysadmin work. This hack remaps another &#8230; <a class="more-link" href="http://blog.gorwits.me.uk/2011/11/30/hacking-in-os-x/">Continue reading <span class="meta-nav">&#8594;</span></a>]]></description>
				<content:encoded><![CDATA[<p>To get aÂ <code>#</code> sign on an Apple keyboard you use the Option (or Alt) key + 3. This seems terribly klunky to me, andÂ <code>#</code> is of course used quite a bit in programming and sysadmin work.</p>
<p>This hack remaps another key on the keyboard to produce theÂ <code>#</code> character. I chose the funny squiggle that&#8217;s to the left of the number 1 key (Â§). This is theÂ <em>Section sign</em>, used in document formatting. Just create a file atÂ <code>~/Library/KeyBindings/DefaultKeyBinding.dict</code> which contains the following:</p>
<pre class="brush: plain; title: ; notranslate">
{
    /* this will make all &amp;#167; turn into # */
    &quot;\UA7&quot; = (&quot;insertText:&quot;, &quot;#&quot;);
}
</pre>
<p>Any app that uses Apple&#8217;s Cocoa interface widgets for text input will pick this up after being restarted. There are some that don&#8217;t (perhaps TextMate? Not checked that one so if you know, please comment).</p>
<p>A lot more information about this is available at this excellent page on theÂ <a rel="nofollow" href="http://www.hcs.harvard.edu/~jrus/Site/Cocoa%20Text%20System.html" target="_blank">Cocoa Text System</a>, including some other neat hacks. Enjoy!</p>
]]></content:encoded>
			<wfw:commentRss>http://blog.gorwits.me.uk/2011/11/30/hacking-in-os-x/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>Is it silly that tmux is fun?</title>
		<link>http://blog.gorwits.me.uk/2011/08/15/is-it-silly-that-tmux-is-fun/?utm_source=rss&#038;utm_medium=rss&#038;utm_campaign=is-it-silly-that-tmux-is-fun</link>
		<comments>http://blog.gorwits.me.uk/2011/08/15/is-it-silly-that-tmux-is-fun/#comments</comments>
		<pubDate>Mon, 15 Aug 2011 15:08:00 +0000</pubDate>
		<dc:creator>Oliver Gorwits</dc:creator>
				<category><![CDATA[devops]]></category>
		<category><![CDATA[linux]]></category>
		<category><![CDATA[productivity]]></category>

		<guid isPermaLink="false">http://blog.gorwits.me.uk/?p=575</guid>
		<description><![CDATA[No, I don&#8217;t think it&#8217;s a bad thing to get a zing of excitement when you find a new tool that improves your life. Maybe you know what I mean &#8211; that feeling of happiness at saving time, remembering more &#8230; <a class="more-link" href="http://blog.gorwits.me.uk/2011/08/15/is-it-silly-that-tmux-is-fun/">Continue reading <span class="meta-nav">&#8594;</span></a>]]></description>
				<content:encoded><![CDATA[<p>No, I don&#8217;t think it&#8217;s a bad thing to get a zing of excitement when you find a new tool that improves your life. Maybe you know what I mean &#8211; that feeling of happiness at saving time, remembering more easily how to do things, and satisfaction with a new workflow.</p>
<p>Recently I migrated from the venerable <a href="http://www.gnu.org/s/screen/" target="_blank">screen</a>, to <a href="http://tmux.sourceforge.net/" target="_blank">tmux</a>, and whilst it&#8217;s one of those changes where the old tool had no real show-stopping problems, tmux immediately feels much cleaner and well thought-through.</p>
<p>I&#8217;ll leave you to read the docs and list of features yourself, but please do check this tool out if you&#8217;re an avid screen user. I&#8217;ve already got many more tmux sessions/windows/panes open than ever felt comfortable with screen, saving me a lot of time and effort when working remotely.</p>
]]></content:encoded>
			<wfw:commentRss>http://blog.gorwits.me.uk/2011/08/15/is-it-silly-that-tmux-is-fun/feed/</wfw:commentRss>
		<slash:comments>1</slash:comments>
		</item>
		<item>
		<title>The Limoncelli Test</title>
		<link>http://blog.gorwits.me.uk/2011/07/28/the-limoncelli-test/?utm_source=rss&#038;utm_medium=rss&#038;utm_campaign=the-limoncelli-test</link>
		<comments>http://blog.gorwits.me.uk/2011/07/28/the-limoncelli-test/#comments</comments>
		<pubDate>Thu, 28 Jul 2011 13:40:48 +0000</pubDate>
		<dc:creator>Oliver Gorwits</dc:creator>
				<category><![CDATA[devops]]></category>
		<category><![CDATA[linux]]></category>
		<category><![CDATA[monitoring]]></category>

		<guid isPermaLink="false">http://blog.gorwits.me.uk/?p=563</guid>
		<description><![CDATA[Over at the excellent Everything Sysadmin blog is a simple test which can be applied to your Sysadmin team to assess its productivity and quality of service. It&#8217;s quite straightforward &#8211; just 32 things a good quality team ought to &#8230; <a class="more-link" href="http://blog.gorwits.me.uk/2011/07/28/the-limoncelli-test/">Continue reading <span class="meta-nav">&#8594;</span></a>]]></description>
				<content:encoded><![CDATA[<p>Over at the excellent <a href="http://everythingsysadmin.com/the-test.html" target="_blank">Everything Sysadmin blog</a> is a simple test which can be applied to your Sysadmin team to assess its productivity and quality of service. It&#8217;s quite straightforward &#8211; just 32 things a good quality team ought to be doing, with a few identified as must-have items.</p>
<p>Of course I&#8217;m not going to say anything about my current workplace but thought it would be interesting to assess my <a href="http://www.oucs.ox.ac.uk/network/index.xml.ID=body.1_div.2" target="_blank">previous</a> <a href="http://blogs.oucs.ox.ac.uk/networks/" target="_blank">team</a> as of October 2010 when I left. I&#8217;m incredibly proud of the work we did and both our efficiency and effectiveness in delivering services with limited resources. That&#8217;s reflected in the score of (drumroll&#8230;) 31 out of 32!</p>
<p>If you have a Sysadmin team, or work in one, why not quickly run through the test for yourself?</p>
]]></content:encoded>
			<wfw:commentRss>http://blog.gorwits.me.uk/2011/07/28/the-limoncelli-test/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>Migrate SourceForge CVS repository to git</title>
		<link>http://blog.gorwits.me.uk/2011/06/22/migrate-sourceforge-cvs-repository-to-git/?utm_source=rss&#038;utm_medium=rss&#038;utm_campaign=migrate-sourceforge-cvs-repository-to-git</link>
		<comments>http://blog.gorwits.me.uk/2011/06/22/migrate-sourceforge-cvs-repository-to-git/#comments</comments>
		<pubDate>Wed, 22 Jun 2011 19:27:00 +0000</pubDate>
		<dc:creator>Oliver Gorwits</dc:creator>
				<category><![CDATA[devops]]></category>
		<category><![CDATA[git]]></category>
		<category><![CDATA[linux]]></category>
		<category><![CDATA[netdisco]]></category>

		<guid isPermaLink="false">http://blog.gorwits.me.uk/?p=529</guid>
		<description><![CDATA[Updated to include promoting and pushing tags. I recently had need to migrate some SourceForge CVS repositories to git. I&#8217;ll admit I&#8217;m no git expert, so Googled around for advice on the process. What I ended up doing was sufficiently &#8230; <a class="more-link" href="http://blog.gorwits.me.uk/2011/06/22/migrate-sourceforge-cvs-repository-to-git/">Continue reading <span class="meta-nav">&#8594;</span></a>]]></description>
				<content:encoded><![CDATA[<p><em>Updated to include promoting and pushing tags.</em></p>
<p>I recently had need to <a href="https://sites.google.com/site/gorwits/home/netdisco-git" target="_blank">migrate</a> some SourceForge CVS repositories to git. I&#8217;ll admit I&#8217;m no git expert, so Googled around for advice on the process. What I ended up doing was sufficiently distinct from any other guide that I feel it worth recording the process, here.</p>
<p>The SourceForge <a href="http://sourceforge.net/apps/trac/sourceforge/wiki/Git" target="_blank">wiki page on git</a> is a good start. It explains that you should log into the Project&#8217;s Admin page, go to Features, and tick to enable git. Although it&#8217;s not made clear, there&#8217;s no problem having both CVS and git enabled concurrently.</p>
<p>Enabling git for the first time will initialize a bare git repository for your project. You can have multiple repositories; the first is named the same as the project itself. If you screw things up, it&#8217;s OK to delete the repository (via an SSH login) and initialize a new one.</p>
<p>Just like the SourceForge documentation, I&#8217;ll use USERNAME, PROJECTNAME and REPONAME within commands. As just mentioned, the initial configuration is that the latter two are equal, until you progress to additional git repositories.</p>
<p>Let&#8217;s begin by grabbing a copy of the CVS repository with complete history, using the rsync utility. When you rsync, there will be a directory containing <code>CVSROOT</code> (which can be ignored) and one subdirectory per module:</p>
<pre class="brush: plain; title: ; notranslate">
mkdir cvs &amp;&amp; cd cvs
rsync -av rsync://PROJECTNAME.cvs.sourceforge.net/cvsroot/PROJECTNAME/* .
</pre>
<p>Grab the latest cvs2git code and copy the default options file. Change the <code>run_options.set_project</code> setting to point to your project&#8217;s module subdirectory:</p>
<pre class="brush: plain; title: ; notranslate">
svn export --username=guest http://cvs2svn.tigris.org/svn/cvs2svn/trunk cvs2svn-trunk
cp cvs2svn-trunk/cvs2git-example.options cvs2git.options
vi cvs2git.options
# edit the string after run_options.set_project, to mention cvs/PROJECTNAME
</pre>
<p>Also in the options file, set the committer name mappings in the <code>author_transforms</code> settings. This is needed because CVS logs only show usernames but git commit logs show human name and email &#8211; a mapping can be used during import to create a sensible git history.</p>
<pre class="brush: plain; title: ; notranslate">
vi cvs2git.options
# read the comments above author_transforms and make changes
</pre>
<p>But how do you know what CVS usernames need mapping? One solution is to run through this export and git import <em>without</em> a mapping, then run <code>git shortlog -se</code> to dump the commiters. Blow the new git repo away, and re-import after configuring cvs2git <code>author_transforms</code>.</p>
<p>The cvs2git utility works by generating the input files used by git&#8217;s fast-import command:</p>
<pre class="brush: plain; title: ; notranslate">
cvs2svn-trunk/cvs2git --options=cvs2git.options --fallback-encoding utf-8
git clone ssh://USERNAME@PROJECTNAME.git.sourceforge.net/gitroot/PROJECTNAME/REPONAME
cd REPONAME
cat ../cvs2svn-tmp/git-{blob,dump}.dat | git fast-import
git reset --hard
</pre>
<p>At this point, if you&#8217;re going to continue using this new git repository for work, remember to set your <code>user.name</code>, <code>user.email</code> and <code>color.ui</code> options.</p>
<p>Now you&#8217;re ready to push the repo back to SourceForge. I did test myself that disabling so-called <em>developer access</em> to the repo in the SourceForge Project Member settings page does in fact prevent write access, as expected.</p>
<pre class="brush: plain; title: ; notranslate">
git push origin master
</pre>
<p>If you had tags on the CVS repo (<code>git tag -l</code>), they&#8217;ll have been imported as <em>lightweight tags</em>. Best practice is always to use annotated tags, so this short script will promote them for you:</p>
<pre class="brush: plain; title: ; notranslate">
git config user.name &quot;Firstname Lastname&quot;
git config user.email &quot;me@example.com&quot;
git tag -l | while read ver;
  do git checkout $ver;
  git tag -d $ver;
  GIT_COMMITTER_DATE=&quot;$(g show --format=%aD | head -1)&quot; git tag -a $ver -m &quot;prep for $ver release&quot;;
  done
git checkout master
</pre>
<p>Verify the tags are as you want, using something like:</p>
<pre class="brush: plain; title: ; notranslate">
git tag -l | while read tag; do git show $tag | head -3; echo; done
</pre>
<p>And then push them to the repository with:</p>
<pre class="brush: plain; title: ; notranslate">
git push --tags
</pre>
<p>Something you might want to do is set a post-commit email hook. For this you <a href="https://sourceforge.net/apps/trac/sourceforge/wiki/Shell%20service" target="_blank">SSH to SourceForge</a>, and if you have multiple projects remember to connect to the right one!</p>
<pre class="brush: plain; title: ; notranslate">
ssh -t USER,PROJECT@shell.sourceforge.net create
cd /home/scm_git/P/PR/PROJECTNAME
</pre>
<p>Download the <a href="http://tinyurl.com/git-post-commit-email" target="_blank">post-receive-email script</a> and place it in the hooks subdirectory; make it executable. Also set the permissions to have group-write, so your project colleagues can alter it if required. Set the necessary git options to allow the script to email someone after a commit. Season to taste.</p>
<pre class="brush: plain; title: ; notranslate">
curl -L http://tinyurl.com/git-post-commit-email &gt; hooks/post-receive
chmod +x hooks/post-receive
chmod g+w hooks/post-receive
git config hooks.emailprefix &quot;[git push]&quot;
git config hooks.emailmaxlines 500
git config hooks.envelopesender noreply@sourceforge.net
git config hooks.showrev &quot;t=%s; printf 'http://PROJECTNAME.git.sourceforge.net/git/gitweb.cgi?p=PROJECTNAME/REPONAME;a=commitdiff;h=%%s' ; echo;echo; git show -C ; echo&quot;
git config hooks.mailinglist PROJECTNAME-COMMITS@lists.sourceforge.net
</pre>
<p>Remember to subscribe <code>noreply@sourceforge.net</code> to your announce list, if needed. Finally, set a friendly description on the repository for use by the git web-based repo browser:</p>
<pre class="brush: plain; title: ; notranslate">
echo 'PROJECTNAME git repository' &gt; description
</pre>
<p>One other thing I did was enable an SSH key on my SourceForge account, as this makes life with SSH-based git much smoother <img src='http://blog.gorwits.me.uk/wp-includes/images/smilies/icon_smile.gif' alt=':-)' class='wp-smiley' />  If you have the need to create additional git repositories, or even to replace the one created automatically, then it&#8217;s just a case of issuing the git command:</p>
<pre class="brush: plain; title: ; notranslate">
cd /home/scm_git/P/PR/PROJECTNAME
git --git-dir=REPONAME init --shared=all --bare
</pre>
<p>Good luck with your own migrations, and happy coding!</p>
]]></content:encoded>
			<wfw:commentRss>http://blog.gorwits.me.uk/2011/06/22/migrate-sourceforge-cvs-repository-to-git/feed/</wfw:commentRss>
		<slash:comments>7</slash:comments>
		</item>
		<item>
		<title>A Strategy for Opsview Keywords</title>
		<link>http://blog.gorwits.me.uk/2011/05/20/a-strategy-for-opsview-keywords/?utm_source=rss&#038;utm_medium=rss&#038;utm_campaign=a-strategy-for-opsview-keywords</link>
		<comments>http://blog.gorwits.me.uk/2011/05/20/a-strategy-for-opsview-keywords/#comments</comments>
		<pubDate>Fri, 20 May 2011 15:04:54 +0000</pubDate>
		<dc:creator>Oliver Gorwits</dc:creator>
				<category><![CDATA[devops]]></category>
		<category><![CDATA[linux]]></category>
		<category><![CDATA[monitoring]]></category>

		<guid isPermaLink="false">http://blog.gorwits.me.uk/?p=492</guid>
		<description><![CDATA[At my previous employer, and recently at my current one, I&#8217;ve been responsible for migration to an Opsview based monitoring system. Opsview is an evolution of Nagios which brings a multitude of benefits. I encourage you to check it out. &#8230; <a class="more-link" href="http://blog.gorwits.me.uk/2011/05/20/a-strategy-for-opsview-keywords/">Continue reading <span class="meta-nav">&#8594;</span></a>]]></description>
				<content:encoded><![CDATA[<p>At my <a href="https://noc-monitor.oucs.ox.ac.uk/viewport#style=cells" target="_blank">previous employer</a>, and recently at my current one, I&#8217;ve been responsible for migration to an Opsview based monitoring system. <a href="http://www.opsera.com/products/opsview/Opsview_overview.dot" target="_blank">Opsview</a> is an evolution of Nagios which brings a multitude of benefits. I encourage you to check it out.</p>
<p>Since the 3.11.3 release, <em>keywords</em> have been put front and centre of the system&#8217;s administration, so I want to present here what I&#8217;ve been working on as a strategy for their configuration. Keywords can support three core parts of the Opsview system:</p>
<ol>
<li>The Viewport (a traffic-lights status overview)</li>
<li>User access controls (what services/hosts can beÂ acknowledged, etc)</li>
<li>Notifications (what you receive emails about)</li>
</ol>
<h2>Most important&#8230;</h2>
<p>My first bit of advice is <em>do not ever</em> set the keywords when provisioning a new Host or Service Check. This is because on these screens you can&#8217;t see the complete context of keywords, and it&#8217;s far too easy to create useless duplication. You should instead associate keywords with hosts and services from the <span style="text-decoration: underline;">Configuration/Keywords</span> screen.</p>
<h2>Naming Convention</h2>
<p>Okay, let&#8217;s go to that screen now, and talk about our naming convention. Yes, there needs to be one, so that you can look at a keyword in another part of Opsview and have a rough idea what it might be associated with. Here&#8217;s the template I use, and some examples:</p>
<pre class="brush: plain; title: ; notranslate">
&lt;type&gt;-[&lt;owner&gt;-]&lt;thing&gt;

device-ups
server-linux
service-smtpmsa
service-nss-ntpstratum3
</pre>
<p>Let&#8217;s say you have a Linux server running an SMTP message submission service and an NTP Stratum 3 service. I would create one keyword for the underlying operating system (CPU, memory, disk, etc), named &#8220;<code>server-linux</code>&#8220;. I&#8217;d create another for the SMTP service as &#8220;<code>service-smtpmsa</code>&#8221; and another for the NTP as &#8220;<code>service-ntpstratum3</code>&#8220;. If your Opsview is shared between a number of teams, it might also be useful to insert the managing team for that service in the name, as I&#8217;ve done with NSS, above. The type &#8220;<code>device</code>&#8221; tends to be reserved for appliances which fulfil one function, so you don&#8217;t need to separate out their server/service nature.</p>
<p><a rel="attachment wp-att-507" href="http://blog.gorwits.me.uk/2011/05/20/a-strategy-for-opsview-keywords/keywords/"><img class="aligncenter size-full wp-image-507" title="keywords" src="http://blog.gorwits.me.uk/wp-content/blog.gorwits.me.uk/2011/05/keywords.png" alt="" width="633" height="112" /></a></p>
<p>With this in place, if the UNIX Systems team manages the server and OS, and another team manages the applications stack on the box, we&#8217;ve got keywords for each, allowing easy and fine grained visibility controls. When creating the keywords, you should go into the <span style="text-decoration: underline;">Objects</span> tab and associate it with the appropriate hosts and service checks. I find this <em>much</em> more straightforward than using the <span style="text-decoration: underline;">Keywords</span> field on the actual host and service check configuration pages.</p>
<h2>Viewport</h2>
<p>Let&#8217;s look at each of the three cornerstone uses I mentioned above, in turn. First is the Viewport. Well, that&#8217;s easy enough to enable for a keyword by toggling the radio button and assigning a sensible description (such as ï»¿ï»¿&#8221;Email Message Submission Service&#8221; for &#8220;<code>service-smtpmsa</code>&#8220;). Which users can see which items in their own viewport is configured in the role (<span style="text-decoration: underline;">Advanced/Roles</span>) associated to that user. I&#8217;d clone off one new role per user, and go to the <span style="text-decoration: underline;">Objects</span> tab, remove all Host Groups or Service Groups and select only some Keywords. Job done &#8211; the user now sees those items in their viewport.</p>
<h2><a rel="attachment wp-att-510" href="http://blog.gorwits.me.uk/2011/05/20/a-strategy-for-opsview-keywords/viewport/"><img class="aligncenter size-full wp-image-510" title="viewport" src="http://blog.gorwits.me.uk/wp-content/blog.gorwits.me.uk/2011/05/viewport.png" alt="" width="496" height="245" /></a></h2>
<h2>Actions</h2>
<p>Next up is the ability for a user to acknowledge, or mark as down, an item. In fact it&#8217;s done in the same way as the viewport, that is, through a role. That&#8217;s because roles contain, on the Access tab, the <code>VIEWPORTACCESS</code> item for viewports and the <code>ACTIONSOME/NOTIFYSOME</code> items for actioning alerts. Because it&#8217;s currently only possible for a user to have one role, you cannot easily separate these rights for different keywords &#8211; a real pity. But I have no doubt multiple roles will come along, just like multiple notification profiles.</p>
<h2><a rel="attachment wp-att-511" href="http://blog.gorwits.me.uk/2011/05/20/a-strategy-for-opsview-keywords/access/"><img class="aligncenter size-full wp-image-511" title="access" src="http://blog.gorwits.me.uk/wp-content/blog.gorwits.me.uk/2011/05/access.png" alt="" width="229" height="245" /></a>Notifications</h2>
<p>Which brings us to the final item. Again I&#8217;d create a new notification profile for each user, so that it&#8217;s possible to opt them in or out of any service notifications. Using keywords makes things simple &#8211; are you just managing the underlying OS? Then you can have notifications about that, and not the application stack. It doesn&#8217;t stop you seeing the app stack status in your viewport, though. Because the notification profile is associated with a user, you&#8217;ll only be offered keywords that have been authorized in their role, which is a nice touch.</p>
<h2>And finally&#8230;</h2>
<p>In each of these steps the naming convention has really helped, because when looking at keywords the meaning &#8220;these hosts&#8221; or &#8220;this service&#8221; will (hopefully) jump out.Â If I were scaling this up, I&#8217;d have it all provisioned via the Opsview API from a configuration management or inventory database, and updated nightly. This is another way naming conventions help &#8211; they are friendly to automation.</p>
]]></content:encoded>
			<wfw:commentRss>http://blog.gorwits.me.uk/2011/05/20/a-strategy-for-opsview-keywords/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>Cfengene3 on Debian Squeeze for local management</title>
		<link>http://blog.gorwits.me.uk/2011/05/10/cfengene3-on-debian-squeeze-for-local-management/?utm_source=rss&#038;utm_medium=rss&#038;utm_campaign=cfengene3-on-debian-squeeze-for-local-management</link>
		<comments>http://blog.gorwits.me.uk/2011/05/10/cfengene3-on-debian-squeeze-for-local-management/#comments</comments>
		<pubDate>Tue, 10 May 2011 20:31:11 +0000</pubDate>
		<dc:creator>Oliver Gorwits</dc:creator>
				<category><![CDATA[devops]]></category>
		<category><![CDATA[linux]]></category>

		<guid isPermaLink="false">http://blog.gorwits.me.uk/?p=479</guid>
		<description><![CDATA[Dialling the nerd factor up to 11, I&#8217;ve decided to store configuration for my VPS server in git and manage it with Cfengine3. Joking aside, this is a sound decision: having the VCS repo makes backups simple and trustworthy, and &#8230; <a class="more-link" href="http://blog.gorwits.me.uk/2011/05/10/cfengene3-on-debian-squeeze-for-local-management/">Continue reading <span class="meta-nav">&#8594;</span></a>]]></description>
				<content:encoded><![CDATA[<p>Dialling the nerd factor up to 11, I&#8217;ve decided to store configuration for my <a href="https://www.portfast.co.uk/vps.shtml" target="_blank">VPS server</a> in <a href="http://git-scm.com/" target="_blank">git</a> and manage it with <a href="http://www.cfengine.org" target="_blank">Cfengine3</a>. Joking aside, this is a sound decision: having the VCS repo makes backups simple and trustworthy, and configurationÂ managementÂ motivates me to keep on using that repository.</p>
<p>On Debian Squeeze it&#8217;s a simple case of <code>apt-get install cfengine3</code>, with the caveat of <a href="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=611659" target="_blank">this packaging bug</a> meaning I hacked <code>/etc/cfengine3</code> to symlink from <code>/var/lib/cfengine3/inputs</code>.</p>
<h6><em>[Edit: A colleague of mine, David, suggests that the package should link cfengine3's masterfiles to /etc, and I'm inclined to agree.]</em></h6>
<p>Anyone familiar with Cfengine2 will have a good head start on the Cfengine3 configuration, however it&#8217;s still a bit of a learning curve (but we know <a href="http://answers.google.com/answers/threadview?id=512538" target="_blank">complex problems rarely have simple solutions</a>). The first file read is <code>promises.cf</code> which can include other files (&#8220;<code>inputs</code>&#8220;, in any order), and lists the promise bundles and their order of execution:</p>
<pre class="brush: plain; title: ; notranslate">
body common control {
    bundlesequence  =&gt; {
            &quot;main&quot;
    };

    inputs =&gt; {
        &quot;site.cf&quot;,
        &quot;library.cf&quot;
    };
}
</pre>
<p>The <code>library.cf</code> file is simply a bunch of macros or templates. For example, the built-in <code>copy_from</code> command is augmented with some sane defaults and named <code>local_copy</code>:</p>
<pre class="brush: plain; title: ; notranslate">
body copy_from local_copy(from) {
    source  =&gt; &quot;$(from)&quot;;
    compare =&gt; &quot;digest&quot;;
    copy_backup =&gt; false;
}
</pre>
<p>This is then used in my <code>site.cf</code> file to install some cron jobs:</p>
<pre class="brush: plain; title: ; notranslate">
bundle agent main {
    vars:
        &quot;repo&quot; string =&gt; &quot;/path/to/git/repo&quot;;

    files:
        &quot;/etc/cron.d&quot;
            handle =&gt; &quot;cron_files&quot;,
            comment =&gt; &quot;copy crontab files to /etc/cron.d&quot;,

            copy_from =&gt; local_copy(&quot;$(repo)/etc/cron.d&quot;),
            depth_search =&gt; recurse(&quot;inf&quot;),
            perms =&gt; p(&quot;root&quot;,&quot;444&quot;);
}
</pre>
<p>This is a trivial example, and could be made better. For example <em>all</em> files in the target directory have their permissions changed (via the &#8220;<code>p</code>&#8221; macro), whereas it makes sense only to set those files we copy, not any already existing.</p>
<p>Hopefully this post shows that Cfengine3 configuration isn&#8217;t that hairy, and once the principles are installed in your head it&#8217;s a case of browsing the <a href="http://www.cfengine.org/manuals/cf3-reference.html" target="_blank">reference manual</a> and building up promise libraries.</p>
<p><strong><em><span style="text-decoration: underline;">Postscript</span></em></strong></p>
<p>I&#8217;d like to note that the Cfengine3 configuration mini-language could be better designed. Some statements are terminated by semicolons as in the <code>body</code>, above, others separated by commas but still semicolon-terminated, as in the <code>bundle</code>, and braced sections inconsistently semicolon-terminated. This leads to awkward syntax errors when designing new promises <img src='http://blog.gorwits.me.uk/wp-includes/images/smilies/icon_sad.gif' alt=':-(' class='wp-smiley' /> </p>
<p>Furthermore, I feel the language would benefit from some <a href="http://www.catb.org/~esr/writings/taoup/html/ch08s02.html#fetchmailrc" target="_blank">noise keywords</a>, for example:</p>
<pre class="brush: plain; title: ; notranslate">
body copy_from local_copy(from) {
</pre>
<p>versus</p>
<pre class="brush: plain; title: ; notranslate">
body copy_from as local_copy(from) {
</pre>
<p>The latter makes it <em>slightly</em> more clear which is the base primitive and which the new macro name. I&#8217;m a <a href="http://search.cpan.org/perldoc?Net::CLI::Interact::Phrasebook#PHRASEBOOK_FORMAT" target="_blank">great fan</a> of the use of syntactic sugar, in moderation, and intuitive configuration mini-languages.</p>
]]></content:encoded>
			<wfw:commentRss>http://blog.gorwits.me.uk/2011/05/10/cfengene3-on-debian-squeeze-for-local-management/feed/</wfw:commentRss>
		<slash:comments>2</slash:comments>
		</item>
		<item>
		<title>Starting irssi in screen at reboot</title>
		<link>http://blog.gorwits.me.uk/2011/03/27/starting-irssi-in-screen-at-reboot/?utm_source=rss&#038;utm_medium=rss&#038;utm_campaign=starting-irssi-in-screen-at-reboot</link>
		<comments>http://blog.gorwits.me.uk/2011/03/27/starting-irssi-in-screen-at-reboot/#comments</comments>
		<pubDate>Sun, 27 Mar 2011 22:00:31 +0000</pubDate>
		<dc:creator>Oliver Gorwits</dc:creator>
				<category><![CDATA[linux]]></category>

		<guid isPermaLink="false">http://blog.gorwits.me.uk/?p=449</guid>
		<description><![CDATA[Another short aide-mÃ©moire. My IRC client is irssi, running in a screen session on my linux server in London. I connect to it via SSH, but if the server restarts I want this all set up automatically. Fire up crontab &#8230; <a class="more-link" href="http://blog.gorwits.me.uk/2011/03/27/starting-irssi-in-screen-at-reboot/">Continue reading <span class="meta-nav">&#8594;</span></a>]]></description>
				<content:encoded><![CDATA[<p>Another short aide-mÃ©moire. My IRC client is irssi, running in a screen session on my linux server in London. I connect to it via SSH, but if the server restarts I want this all set up automatically. Fire up <code>crontab -e</code> and add the following:</p>
<pre class="brush: plain; title: ; notranslate">
@reboot /usr/bin/screen -dmUS irc /usr/bin/irssi
</pre>
<p>A brief rundown of the options:</p>
<ul>
<li><code>@reboot</code> : run this cron job when the cron daemon is restarting after a reboot</li>
<li><code>-dm</code> : start screen in &#8216;detached&#8217; mode</li>
<li><code>-U</code> : run screen in UTF-8 mode (see my <a href="http://blog.gorwits.me.uk/2011/03/27/fixing-character-encoding-with-irssi-and-screen/" target="_blank">other post</a>)</li>
<li><code>-S irc</code> : give the screen session a friendly name, for reattaching using <code>-r</code></li>
</ul>
<p>This requires that the irssi configuration at least have all the channel and server configuration and is set to auto-connect, of course.</p>
]]></content:encoded>
			<wfw:commentRss>http://blog.gorwits.me.uk/2011/03/27/starting-irssi-in-screen-at-reboot/feed/</wfw:commentRss>
		<slash:comments>2</slash:comments>
		</item>
		<item>
		<title>Fixing character encoding with irssi and screen</title>
		<link>http://blog.gorwits.me.uk/2011/03/27/fixing-character-encoding-with-irssi-and-screen/?utm_source=rss&#038;utm_medium=rss&#038;utm_campaign=fixing-character-encoding-with-irssi-and-screen</link>
		<comments>http://blog.gorwits.me.uk/2011/03/27/fixing-character-encoding-with-irssi-and-screen/#comments</comments>
		<pubDate>Sun, 27 Mar 2011 21:48:28 +0000</pubDate>
		<dc:creator>Oliver Gorwits</dc:creator>
				<category><![CDATA[linux]]></category>

		<guid isPermaLink="false">http://blog.gorwits.me.uk/?p=442</guid>
		<description><![CDATA[Yes, this old chestnut. Time and again I forget the steps to get a new (Debian-ish) system working properly such that I can ssh in and reattach to a screen&#8217;d irssi session and have character encoding work properly. That is, &#8230; <a class="more-link" href="http://blog.gorwits.me.uk/2011/03/27/fixing-character-encoding-with-irssi-and-screen/">Continue reading <span class="meta-nav">&#8594;</span></a>]]></description>
				<content:encoded><![CDATA[<p>Yes, this old chestnut. Time and again I forget the steps to get a new (Debian-ish) system working properly such that I can ssh in and reattach to a screen&#8217;d irssi session and have character encoding work properly. That is, I can enter a Â£ sign and it doesn&#8217;t come out like I just swore at the channel.</p>
<p>Probably one of the <a href="http://www.iovene.com/54/" target="_blank">simplest guides</a> is by Salvatore Iovene, from which IÂ summariseÂ the following steps:</p>
<ol>
<li><code>sudo dpkg-reconfigure locales</code></li>
<li>start screen with <code>-U</code></li>
<li>Add some options to the irssi configuration</li>
</ol>
<p>For that last part, I think I worked out which stanza the config should go in:</p>
<pre class="brush: plain; title: ; notranslate">
settings = {
  core = {
    recode = &quot;yes&quot;;
    recode_autodetect_utf8 = &quot;yes&quot;;
    recode_fallback = &quot;UTF-8&quot;;
    recode_out_default_charset = &quot;UTF-8&quot;;
    recode_transliterate = &quot;yes&quot;;
  };
  &quot;fe-common/core&quot; = {
    term_charset = &quot;UTF-8&quot;;
  };
};
</pre>
]]></content:encoded>
			<wfw:commentRss>http://blog.gorwits.me.uk/2011/03/27/fixing-character-encoding-with-irssi-and-screen/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
	</channel>
</rss>
